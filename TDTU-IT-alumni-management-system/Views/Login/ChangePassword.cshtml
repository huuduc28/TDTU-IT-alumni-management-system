@{
    ViewBag.Title = "ChangePassword";
    Layout = "~/Views/Shared/Mylayout.cshtml";
}
<link rel="icon" type="image/x-icon" href="~/Upload/images/Logo/logo-tdtu.png">

<style>
    .tempFixed {
        margin-left: auto;
        margin-right: auto;
        width: 60%;
    }
</style>
<!-- Modal hiển thị thông báo thành công -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="successModalLabel">Thành công</h5>
            </div>
            <div class="modal-body">
                <!-- Hiển thị thông báo thành công -->
                <p id="successMessage"></p>
            </div>
            <div class="modal-footer">
                <!-- Nút đóng modal -->
            </div>
        </div>
    </div>
</div>
<!-- Modal hiển thị thông báo lỗi -->
<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="errorModalLabel">Lỗi</h5>
            </div>
            <div class="modal-body">
                <!-- Hiển thị thông báo lỗi -->
                <p id="errorMessage"></p>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
<div class="container tempFixed p-5">
    <form id="changePassword" novalidate>
        <div class="mb-3">
            <label for="currentPassword" class="form-label">Mật khẩu cũ</label>
            <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
        </div>
        <div class="mb-3">
            <label for="newPassword" class="form-label">Mật khẩu mới</label>
            <input type="password" class="form-control" id="newPassword" name="newPassword" required>
        </div>
        <div class="mb-3">
            <label for="confirmPassword" class="form-label">Nhập lại mật khẩu mới</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
        </div>
        <button type="submit" class="btn btn-primary" disabled>Lưu</button>
    </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script>
    const form = document.getElementById("changePassword");
    const currentPasswordInput = document.getElementById("currentPassword");
    const newPasswordInput = document.getElementById("newPassword");
    const confirmPasswordInput = document.getElementById("confirmPassword");
    const submitButton = document.querySelector("button[type='submit']");

    // Bắt sự kiện nhập liệu
    form.addEventListener("input", () => {
        const isPasswordsValid = newPasswordInput.value === confirmPasswordInput.value && newPasswordInput.value !== "";
        submitButton.disabled = !isPasswordsValid || !currentPasswordInput.value;
    });

    $(document).ready(function () {
        $("#changePassword").submit(function (event) {
            event.preventDefault();

            var currentPassword = $("#currentPassword").val();
            var confirmPassword = $("#confirmPassword").val();


            $.ajax({
                url: '/Login/CheckAndChangeDataInSession',
                type: 'POST',
                data: {
                    CurrentPassword: currentPassword,
                    NewPassword: confirmPassword
                },
                success: function (response) {
                    if (response.success) {
                        $("#successMessage").text(response.message);
                        $("#successModal").modal('show');
                        setTimeout(function () {
                            $("#successModal").modal('hide');
                        }, 1000);
                        window.location.href = '/Login/Index';
                    } else {
                        $("#loading-spinner").hide();
                        $(".login-body").show(); 
                        $("#errorMessage").text(response.message);
                        $("#errorModal").modal('show');
                        setTimeout(function () {
                            $("#errorModal").modal('hide');
                        }, 1000);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $("#errorMessage").text("Có lỗi xảy ra, vui lòng thử lại.");
                    $("#errorModal").modal('show');
                    setTimeout(function () {
                        $("#errorModal").modal('hide');
                    }, 1000);
                }
            });
        });
    });

</script>