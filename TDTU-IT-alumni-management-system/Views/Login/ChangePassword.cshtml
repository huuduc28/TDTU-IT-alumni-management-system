@{
    ViewBag.Title = "ChangePassword";
    Layout = "~/Views/Shared/Mylayout.cshtml";
}

<style>
    .tempFixed {
        margin-left: auto;
        margin-right: auto;
        width: 60%;
    }
</style>
<div class="container tempFixed p-5">
    <form id="changePassword" novalidate>
        <div class="mb-3">
            <label for="currentPassword" class="form-label">Mật khẩu cũ</label>
            <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
        </div>
        <div class="mb-3">
            <label for="newPassword" class="form-label">Mật khẩu mới</label>
            <input type="password" class="form-control" id="newPassword" name="newPassword" required>
        </div>
        <div class="mb-3">
            <label for="confirmPassword" class="form-label">Nhập lại mật khẩu mới</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
        </div>
        <button type="submit" class="btn btn-primary" disabled>Lưu</button>
    </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script>
    const form = document.getElementById("changePassword");
    const currentPasswordInput = document.getElementById("currentPassword");
    const newPasswordInput = document.getElementById("newPassword");
    const confirmPasswordInput = document.getElementById("confirmPassword");
    const submitButton = document.querySelector("button[type='submit']");

    // Bắt sự kiện nhập liệu
    form.addEventListener("input", () => {
        const isPasswordsValid = newPasswordInput.value === confirmPasswordInput.value && newPasswordInput.value !== "";
        submitButton.disabled = !isPasswordsValid || !currentPasswordInput.value;
    });

    $(document).ready(function () {
        $("#changePassword").submit(function (event) {
            event.preventDefault();

            var currentPassword = $("#currentPassword").val();
            var confirmPassword = $("#confirmPassword").val();


            $.ajax({
                url: '/Login/CheckAndChangeDataInSession',
                type: 'POST',
                data: {
                    CurrentPassword: currentPassword,
                    NewPassword: confirmPassword
                },
                success: function (response) {
                    if (response.success) {
                        alert(response.message);
                        window.location.href = '/Login/Index';
                    } else {
                        alert(response.message);
                        
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error("Có lỗi xảy ra, vui lòng thử lại!", textStatus, errorThrown);
                    alert("Có lỗi xảy ra, vui lòng thử lại!");
                }
            });
        });
    });

</script>